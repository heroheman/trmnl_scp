<!-- SCP Foundation Plugin Shared Templates -->

<style>
  .scp-image {
    object-fit: cover;
    width: 100%;
    height: 100%;
  }

  .scp-qr {
    width: 100px;
    height: 100px;
  }

  .scp-qr--small {
    width: 80px;
    height: 80px;
  }

  .object-class {
    font-weight: 600;
    text-transform: uppercase;
  }

  strong {
    font-weight: 700;
  }

  .scp-overlay {
    position: absolute;
  }

  .scp-overlay--top-left {
    top: 0;
    left: 0;
  }

  .scp-overlay--top-right {
    top: 0;
    right: 0;
  }

  .scp-overlay--bottom-left {
    bottom: 0;
    left: 0;
  }

  .scp-text-box {
    background-color: black;
    color: white;
  }

  .scp-image-container {
    position: relative;
  }
</style>

{% comment %} === EXTRACT OBJECT CLASS FROM TAGS === {% endcomment %}
{% template extract_object_class %}
  {% assign object_class_found = "" %}
  {% assign known_classes = "safe,euclid,keter,thaumiel,apollyon,neutralized,decommissioned,pending,explained" | split: "," %}

  {% for tag in tags %}
    {% if known_classes contains tag %}
      {% assign object_class_found = tag %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% comment %} Check for esoteric-class {% endcomment %}
  {% if object_class_found == "" %}
    {% for tag in tags %}
      {% if tag contains "esoteric-class" %}
        {% assign object_class_found = "Esoteric" %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}

  {% comment %} {{ object_class_found }} {% endcomment %}
{% endtemplate %}

{% comment %} === EXTRACT SPECIAL CONTAINMENT PROCEDURES === {% endcomment %}
{% template extract_procedures %}
  {% comment %} Extract content between Special Containment Procedures and Description {% endcomment %}
  {% if raw_content contains "<strong>Special Containment Procedures:</strong>" %}
    {% assign after_procedures = raw_content | split: "<strong>Special Containment Procedures:</strong>" | last %}

    {% if after_procedures contains "<strong>Description:</strong>" %}
      {% assign procedures_text = after_procedures | split: "<strong>Description:</strong>" | first %}
    {% elsif after_procedures contains "<strong>Description</strong>" %}
      {% assign procedures_text = after_procedures | split: "<strong>Description</strong>" | first %}
    {% else %}
      {% assign procedures_text = after_procedures %}
  {% endif %}

    {% comment %} Clean up HTML tags and extra whitespace {% endcomment %}
    {{ procedures_text | strip_html | strip }}
  {% endif %}
{% endtemplate %}

{% comment %} === SCP ITEM TEMPLATE WITH IMAGE === {% endcomment %}
{% template scp_item_with_image %}
  <div class="grid grid--cols-5 gap">
    <div class="col--span-2" style="position: relative;">
      <img
        class="scp-image image-dither image--cover h--full w--full"
        src="{{ image }}"
        alt="{{ title }}">
      <div style="position: absolute; top: 0; left: 0; padding: {{ overlay_padding | default: '8px' }};">
        <div style="display: flex; flex-direction: column; gap: 4px; align-items: flex-start;">
          <p class="title {{ title_size }}" style="background-color: black; color: white; padding: 4px 8px; margin: 0; display: inline-block;">{{ title }}</p>
          {% if object_class and object_class != "" %}
            <p class="text--small" style="background-color: black; color: white; padding: 4px 8px; margin: 0; display: inline-block;">
              <span class="object-class">{{ object_class }}</span>
            </p>
          {% endif %}
        </div>
      </div>
      {% if show_qr != 'false' and qr_data and qr_data != "" %}
        <div style="position: absolute; bottom: 0; left: 0; padding: {{ overlay_padding | default: '8px' }};">
          <img
            class="scp-qr"
            {% if qr_dim and qr_dim != "" %}
            style="width: {{ qr_dim }}; height: {{ qr_dim }};"
            {% endif %}
            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ qr_data | url_encode }}"
            alt="QR code">
        </div>
      {% endif %}
    </div>
    <div class="col--span-3 h--full">
      <div class="content content--left text--left h--full" data-content-limiter="true">
        {% if show_procedures != 'false' and procedures and procedures != "" %}
          <div class="mb--2">
            <span class="label label--small">Special Containment Procedures</span>
            <span class="description">{{ procedures | newline_to_br }}</span>
          </div>
        {% endif %}
        {% if description and description != "" %}
          <span class="description">{{ description | newline_to_br }}</span>
        {% endif %}
      </div>
    </div>
  </div>
{% endtemplate %}

{% comment %} === SCP ITEM TEMPLATE WITH TOP IMAGE === {% endcomment %}
{% template scp_item_with_top_image %}
  <div class="flex flex--col h--full">
    <div class="no-shrink w--full scp-image-container" style="height: {{ image_height | default: '120px' }};">
      <img
        class="scp-image image-dither image--cover h--full w--full"
        src="{{ image }}"
        alt="{{ title }}">
      <div class="scp-overlay scp-overlay--top-left p--1">
        <div class="flex flex--col gap">
          <p class="title {{ title_size }} p--1 scp-text-box">{{ title }}</p>
          {% if object_class and object_class != "" %}
            <p class="text--small p--1 scp-text-box">
              <span class="object-class">{{ object_class }}</span>
            </p>
          {% endif %}
        </div>
      </div>
      {% if show_qr != 'false' and qr_data and qr_data != "" %}
        <div class="scp-overlay {% if qr_position == 'top-right' %}scp-overlay--top-right{% else %}scp-overlay--bottom-left{% endif %} p--1">
          <img
            class="scp-qr{% if qr_size == 'small' %} scp-qr--small{% endif %}"
            {% if qr_dim and qr_dim != "" %}
            style="width: {{ qr_dim }}; height: {{ qr_dim }};"
            {% endif %}
            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ qr_data | url_encode }}"
            alt="QR code">
        </div>
      {% endif %}
    </div>
    <div class="stretch">
      <div class="content content--left text--left h--full" data-content-limiter="true">
        {% if show_procedures != 'false' and procedures and procedures != "" %}
          <div class="mb--2">
            <span class="label label--small">Special Containment Procedures</span>
            <span class="description">{{ procedures | newline_to_br }}</span>
          </div>
        {% endif %}
        {% if description and description != "" %}
          <span class="description">{{ description | newline_to_br }}</span>
        {% endif %}
      </div>
    </div>
  </div>
{% endtemplate %}

{% comment %} === SCP ITEM TEMPLATE WITHOUT IMAGE === {% endcomment %}
{% template scp_item_no_image %}
  <div
    class="content content--left text--left"
    data-content-limiter="true"
    {% if qr_position == "top-left" %}
    style="position: relative; padding-top: 96px;"
    {% endif %}>
    {% if show_qr != 'false' and qr_data and qr_data != "" and qr_position == "top" %}
      <div style="margin-bottom: 8px; display: flex; justify-content: {{ qr_align | default: "flex-start" }};">
        <img
          class="scp-qr{% if qr_size == "small" %} scp-qr--small{% endif %}"
          {% if qr_dim and qr_dim != "" %}
          style="width: {{ qr_dim }}; height: {{ qr_dim }};"
          {% endif %}
          src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ qr_data | url_encode }}"
          alt="QR code">
      </div>
    {% endif %}
    <span class="title {{ title_size }} mb--4" data-clamp="{{ title_clamp }}">{{ title }}</span>
    {% if object_class and object_class != "" %}
      <span class="label mb--4">
        <span class="object-class">{{ object_class }}</span>
      </span>
    {% endif %}
    {% if show_procedures != 'false' and procedures and procedures != "" %}
      <div class="mb--2">
        <span class="label label--small">Special Containment Procedures</span>
        <span class="description">{{ procedures | newline_to_br }}</span>
      </div>
    {% endif %}
    {% if description and description != "" %}
      {% if description_clamp and description_clamp != "" %}
        <span class="description" style="display: -webkit-box; -webkit-line-clamp: {{ description_clamp }}; -webkit-box-orient: vertical; overflow: hidden;">{{ description | newline_to_br }}</span>
      {% else %}
        <span class="description">{{ description | newline_to_br }}</span>
      {% endif %}
    {% endif %}
    {% if show_qr != 'false' and qr_data and qr_data != "" %}
      {% if qr_position == "top-left" %}
        <div style="position: absolute; top: 0; left: 0; padding: 8px; z-index: 2;">
          <img
            class="scp-qr{% if qr_size == "small" %} scp-qr--small{% endif %}"
            {% if qr_dim and qr_dim != "" %}
            style="width: {{ qr_dim }}; height: {{ qr_dim }};"
            {% endif %}
            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ qr_data | url_encode }}"
            alt="QR code">
        </div>
      {% elsif qr_position == "end" %}
        <div style="margin-top: 8px; display: flex; justify-content: {{ qr_align | default: "flex-start" }};">
          <img
            class="scp-qr{% if qr_size == "small" %} scp-qr--small{% endif %}"
            {% if qr_dim and qr_dim != "" %}
            style="width: {{ qr_dim }}; height: {{ qr_dim }};"
            {% endif %}
            src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ qr_data | url_encode }}"
            alt="QR code">
        </div>
      {% endif %}
    {% endif %}
  </div>
{% endtemplate %}

{% comment %} === FOOTER TEMPLATE === {% endcomment %}
{% template scp_footer %}
  <div class="title_bar">
    <span class="title">SCP Foundation</span>
    <span class="instance">
      {% if scp_number %}
        {{ scp_number }}{% else %}Random SCP{% endif %}
      {% if object_class and object_class != "" %}
        | {{ object_class | capitalize }}{% endif %}
    </span>
  </div>
{% endtemplate %}