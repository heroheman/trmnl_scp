<!-- SCP Foundation Plugin Shared Templates -->

<style>
  .scp-image { 
    object-fit: cover; 
    width: 100%; 
    height: 100%;
  }
  
  .object-class {
    font-weight: 600;
    text-transform: uppercase;
  }
</style>

{% comment %} === EXTRACT OBJECT CLASS FROM TAGS === {% endcomment %}
{% template extract_object_class %}
  {% assign object_class_found = "" %}
  {% assign known_classes = "safe,euclid,keter,thaumiel,apollyon,neutralized,decommissioned,pending,explained" | split: "," %}
  
  {% for tag in tags %}
    {% if known_classes contains tag %}
      {% assign object_class_found = tag %}
      {% break %}
    {% endif %}
  {% endfor %}
  
  {% comment %} Check for esoteric-class {% endcomment %}
  {% if object_class_found == "" %}
    {% for tag in tags %}
      {% if tag contains "esoteric-class" %}
        {% assign object_class_found = "Esoteric" %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
  
  {% comment %} {{ object_class_found }} {% endcomment %}
{% endtemplate %}

{% comment %} === EXTRACT SPECIAL CONTAINMENT PROCEDURES === {% endcomment %}
{% template extract_procedures %}
  {% comment %} Extract content between Special Containment Procedures and Description {% endcomment %}
  {% if raw_content contains "<strong>Special Containment Procedures:</strong>" %}
    {% assign after_procedures = raw_content | split: "<strong>Special Containment Procedures:</strong>" | last %}
    
    {% if after_procedures contains "<strong>Description:</strong>" %}
      {% assign procedures_text = after_procedures | split: "<strong>Description:</strong>" | first %}
    {% elsif after_procedures contains "<strong>Description</strong>" %}
      {% assign procedures_text = after_procedures | split: "<strong>Description</strong>" | first %}
    {% else %}
      {% assign procedures_text = after_procedures %}
    {% endif %}
    
    {% comment %} Clean up HTML tags and extra whitespace {% endcomment %}
    {{ procedures_text | strip_html | strip }}
  {% endif %}
{% endtemplate %}

{% comment %} === SCP ITEM TEMPLATE WITH IMAGE === {% endcomment %}
{% template scp_item_with_image %}
  <div class="grid grid--cols-5 gap">
    <div class="col--span-2">
      <div class="h--full" style="position: relative;">
        <img class="scp-image image-dither" src="{{ image }}" alt="{{ title }}">
        <div style="position: absolute; top: 0; left: 0; padding: 8px;">
          <p class="title {{ title_size }}" style="background-color: black; color: white; padding: 4px 8px; margin: 0 0 4px 0; display: inline-block;">{{ title }}</p>
          {% if object_class and object_class != "" %}
            <p class="text--small" style="background-color: black; color: white; padding: 4px 8px; margin: 0; display: inline-block;">Object Class: <span class="object-class">{{ object_class }}</span></p>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col--span-3">
      <div class="richtext richtext--left">
        <div class="content content--left text--left" data-content-limiter="true">
            {% if show_procedures != 'false' and procedures and procedures != "" %}<p data-pixel-perfect="true"><strong>Special Containment Procedures:</strong> {{ procedures | newline_to_br }}</p>
            {% endif %}
            {% if description and description != "" %}<p data-pixel-perfect="true"><strong>Description:</strong> {{ description | newline_to_br }}</p>{% endif %}
        </div>
      </div>
    </div>
  </div>
{% endtemplate %}

{% comment %} === SCP ITEM TEMPLATE WITHOUT IMAGE === {% endcomment %}
{% template scp_item_no_image %}
  <div class="richtext richtext--left">
    <div class="content content--left text--left" data-content-limiter="true">
      <p class="title {{ title_size }} mb--4" data-clamp="{{ title_clamp }}">{{ title }}</p>
      {% if object_class and object_class != "" %}
        <p class="text--small mb--4">Object Class: <span class="object-class">{{ object_class }}</span></p>
      {% endif %}
      {% if show_procedures != 'false' and procedures and procedures != "" %}<p><strong>Special Containment Procedures:</strong> {{ procedures | newline_to_br }}</p>{% endif %}{% if description and description != "" %}<p><strong>Description:</strong> {{ description | newline_to_br }}</p>{% endif %}
    </div>
  </div>
{% endtemplate %}

{% comment %} === FOOTER TEMPLATE === {% endcomment %}
{% template scp_footer %}
  <div class="title_bar">
    <span class="title">SCP FOUNDATION</span>
    <span class="instance">
      {% if scp_number %}{{ scp_number }}{% else %}Random SCP{% endif %}
      {% if object_class and object_class != "" %} | {{ object_class | capitalize }}{% endif %}
    </span>
  </div>
{% endtemplate %}

