<div class="layout layout--col gap">
  {% assign scp = data %}
  {% assign show_image = trmnl.plugin_settings.custom_fields_values.show_image %}
  {% assign has_image = false %}
  
  {% comment %} Extract Object Class from tags {% endcomment %}
  {% assign object_class_extracted = "" %}
  {% assign known_classes = "safe,euclid,keter,thaumiel,apollyon,neutralized,decommissioned,pending,explained" | split: "," %}
  {% for tag in scp.tags %}
    {% if known_classes contains tag %}
      {% assign object_class_extracted = tag %}
      {% break %}
    {% endif %}
  {% endfor %}
  {% if object_class_extracted == "" %}
    {% for tag in scp.tags %}
      {% if tag contains "esoteric-class" %}
        {% assign object_class_extracted = "Esoteric" %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
  
  {% comment %} Extract Special Containment Procedures {% endcomment %}
  {% assign procedures_extracted = "" %}
  {% if scp.raw_content contains "<strong>Special Containment Procedures:</strong>" %}
    {% assign after_procedures = scp.raw_content | split: "<strong>Special Containment Procedures:</strong>" | last %}
    {% if after_procedures contains "<strong>Description:</strong>" %}
      {% assign procedures_extracted = after_procedures | split: "<strong>Description:</strong>" | first | strip_html | strip %}
    {% elsif after_procedures contains "<strong>Description</strong>" %}
      {% assign procedures_extracted = after_procedures | split: "<strong>Description</strong>" | first | strip_html | strip %}
    {% endif %}
  {% endif %}
  
  {% comment %} Extract Description {% endcomment %}
  {% assign description_extracted = "" %}
  {% if scp.raw_content contains "<strong>Description:</strong>" %}
    {% assign after_description = scp.raw_content | split: "<strong>Description:</strong>" | last | strip_html | strip %}
    {% assign description_extracted = after_description %}
  {% endif %}
  
  {% comment %} Check if SCP has images {% endcomment %}
  {% if scp.images and scp.images.size > 0 %}
    {% assign first_image = scp.images | first %}
    {% if first_image and first_image != "" %}
      {% assign has_image = true %}
    {% endif %}
  {% endif %}
  
  <div class="content">
    {% if show_image == 'true' and has_image %}
      {% render 'scp_item_with_image',
        title: scp.scp,
        title_size: 'title--medium',
        title_clamp: '2',
        object_class: object_class_extracted,
        show_procedures: trmnl.plugin_settings.custom_fields_values.show_procedures,
        procedures: procedures_extracted,
        description: description_extracted,
        image: first_image
      %}
    {% else %}
      {% render 'scp_item_no_image',
        title: scp.scp,
        title_size: 'title--large',
        title_clamp: '2',
        object_class: object_class_extracted,
        show_procedures: trmnl.plugin_settings.custom_fields_values.show_procedures,
        procedures: procedures_extracted,
        description: description_extracted
      %}
    {% endif %}
  </div>
</div>

{% render 'scp_footer', 
  scp_number: scp.scp,
  min: trmnl.plugin_settings.custom_fields_values.min,
  max: trmnl.plugin_settings.custom_fields_values.max
%}

